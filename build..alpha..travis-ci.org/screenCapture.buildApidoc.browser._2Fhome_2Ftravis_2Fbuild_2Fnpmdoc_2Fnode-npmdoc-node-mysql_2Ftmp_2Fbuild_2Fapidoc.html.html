<html><head></head><body><div class="apidocDiv">
<style>
/*csslint
*/
.apidocDiv {
    background: #fff;
    font-family: Arial, Helvetica, sans-serif;
}
.apidocDiv a[href] {
    color: #33f;
    font-weight: bold;
    text-decoration: none;
}
.apidocDiv a[href]:hover {
    text-decoration: underline;
}
.apidocCodeCommentSpan {
    background: #bbf;
    color: #000;
    display: block;
}
.apidocCodeKeywordSpan {
    color: #d00;
    font-weight: bold;
}
.apidocCodePre {
    background: #eef;
    border: 1px solid;
    color: #777;
    padding: 5px;
    white-space: pre-wrap;
}
.apidocFooterDiv {
    margin-top: 20px;
    text-align: center;
}
.apidocModuleLi {
    margin-top: 10px;
}
.apidocSectionDiv {
    border-top: 1px solid;
    margin-top: 20px;
}
.apidocSignatureSpan {
    color: #777;
    font-weight: bold;
}
</style>
<h1>api documentation for
    <a href="https://github.com/redblaze/node-mysql">node-mysql (v0.4.2)</a>
</h1>
<h4>A wrapper of node.js mysql package to make it a bit easier to use.</h4>
<div class="apidocSectionDiv"><a href="#apidoc.tableOfContents" id="apidoc.tableOfContents"><h1>table of contents</h1></a><ol>

    <li class="apidocModuleLi"><a href="#apidoc.module.node-mysql">module node-mysql</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-mysql.DB">
            function <span class="apidocSignatureSpan">node-mysql.</span>DB
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-mysql.Row">
            function <span class="apidocSignatureSpan">node-mysql.</span>Row
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-mysql.Table">
            function <span class="apidocSignatureSpan">node-mysql.</span>Table
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-mysql.db">
            function <span class="apidocSignatureSpan">node-mysql.</span>db
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">node-mysql.</span>DB.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">node-mysql.</span>Row.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">node-mysql.</span>Table.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">node-mysql.</span>db.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">node-mysql.</span>model</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">string <span class="apidocSignatureSpan">node-mysql.</span>OPTIMISTIC_LOCK_EXCEPTION</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.node-mysql.DB">module node-mysql.DB</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-mysql.DB.DB">
            function <span class="apidocSignatureSpan">node-mysql.</span>DB
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-mysql.DB.format">
            function <span class="apidocSignatureSpan">node-mysql.DB.</span>format
            <span class="apidocSignatureSpan">(str, bindings)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.node-mysql.DB.prototype">module node-mysql.DB.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-mysql.DB.prototype._init">
            function <span class="apidocSignatureSpan">node-mysql.DB.prototype.</span>_init
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-mysql.DB.prototype.add">
            function <span class="apidocSignatureSpan">node-mysql.DB.prototype.</span>add
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-mysql.DB.prototype.clone">
            function <span class="apidocSignatureSpan">node-mysql.DB.prototype.</span>clone
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-mysql.DB.prototype.extend">
            function <span class="apidocSignatureSpan">node-mysql.DB.prototype.</span>extend
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-mysql.DB.prototype.get">
            function <span class="apidocSignatureSpan">node-mysql.DB.prototype.</span>get
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.node-mysql.Row">module node-mysql.Row</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-mysql.Row.Row">
            function <span class="apidocSignatureSpan">node-mysql.</span>Row
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.node-mysql.Row.prototype">module node-mysql.Row.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-mysql.Row.prototype._getVersion">
            function <span class="apidocSignatureSpan">node-mysql.Row.prototype.</span>_getVersion
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-mysql.Row.prototype._init">
            function <span class="apidocSignatureSpan">node-mysql.Row.prototype.</span>_init
            <span class="apidocSignatureSpan">(data, cfg)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-mysql.Row.prototype._load">
            function <span class="apidocSignatureSpan">node-mysql.Row.prototype.</span>_load
            <span class="apidocSignatureSpan">(conn, name, cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-mysql.Row.prototype._nextVersion">
            function <span class="apidocSignatureSpan">node-mysql.Row.prototype.</span>_nextVersion
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-mysql.Row.prototype._refineDtoForUpdate">
            function <span class="apidocSignatureSpan">node-mysql.Row.prototype.</span>_refineDtoForUpdate
            <span class="apidocSignatureSpan">(dto)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-mysql.Row.prototype._update">
            function <span class="apidocSignatureSpan">node-mysql.Row.prototype.</span>_update
            <span class="apidocSignatureSpan">(conn, dto, conditions, cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-mysql.Row.prototype._updateLocalData">
            function <span class="apidocSignatureSpan">node-mysql.Row.prototype.</span>_updateLocalData
            <span class="apidocSignatureSpan">(dto)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-mysql.Row.prototype.get">
            function <span class="apidocSignatureSpan">node-mysql.Row.prototype.</span>get
            <span class="apidocSignatureSpan">(fieldName)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-mysql.Row.prototype.getId">
            function <span class="apidocSignatureSpan">node-mysql.Row.prototype.</span>getId
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-mysql.Row.prototype.linkedBy">
            function <span class="apidocSignatureSpan">node-mysql.Row.prototype.</span>linkedBy
            <span class="apidocSignatureSpan">(conn, name, cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-mysql.Row.prototype.linksTo">
            function <span class="apidocSignatureSpan">node-mysql.Row.prototype.</span>linksTo
            <span class="apidocSignatureSpan">(conn, name, cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-mysql.Row.prototype.load">
            function <span class="apidocSignatureSpan">node-mysql.Row.prototype.</span>load
            <span class="apidocSignatureSpan">(conn, name, cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-mysql.Row.prototype.relatesTo">
            function <span class="apidocSignatureSpan">node-mysql.Row.prototype.</span>relatesTo
            <span class="apidocSignatureSpan">(conn, name, cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-mysql.Row.prototype.update">
            function <span class="apidocSignatureSpan">node-mysql.Row.prototype.</span>update
            <span class="apidocSignatureSpan">(conn, dto, cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-mysql.Row.prototype.updateWithoutOptimisticLock">
            function <span class="apidocSignatureSpan">node-mysql.Row.prototype.</span>updateWithoutOptimisticLock
            <span class="apidocSignatureSpan">(conn, dto, cb)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.node-mysql.Table">module node-mysql.Table</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-mysql.Table.Table">
            function <span class="apidocSignatureSpan">node-mysql.</span>Table
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.node-mysql.Table.prototype">module node-mysql.Table.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-mysql.Table.prototype._create">
            function <span class="apidocSignatureSpan">node-mysql.Table.prototype.</span>_create
            <span class="apidocSignatureSpan">(conn, dto, cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-mysql.Table.prototype._hasUpdatableField">
            function <span class="apidocSignatureSpan">node-mysql.Table.prototype.</span>_hasUpdatableField
            <span class="apidocSignatureSpan">(field)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-mysql.Table.prototype._init">
            function <span class="apidocSignatureSpan">node-mysql.Table.prototype.</span>_init
            <span class="apidocSignatureSpan">(cfg)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-mysql.Table.prototype._lookupLinkedByMap">
            function <span class="apidocSignatureSpan">node-mysql.Table.prototype.</span>_lookupLinkedByMap
            <span class="apidocSignatureSpan">(name)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-mysql.Table.prototype._lookupLinksToMap">
            function <span class="apidocSignatureSpan">node-mysql.Table.prototype.</span>_lookupLinksToMap
            <span class="apidocSignatureSpan">(name)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-mysql.Table.prototype._lookupRelatesToMap">
            function <span class="apidocSignatureSpan">node-mysql.Table.prototype.</span>_lookupRelatesToMap
            <span class="apidocSignatureSpan">(name)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-mysql.Table.prototype._refineDto">
            function <span class="apidocSignatureSpan">node-mysql.Table.prototype.</span>_refineDto
            <span class="apidocSignatureSpan">(dto, autoId)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-mysql.Table.prototype._refineDtoForCreate">
            function <span class="apidocSignatureSpan">node-mysql.Table.prototype.</span>_refineDtoForCreate
            <span class="apidocSignatureSpan">(dto)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-mysql.Table.prototype.baseQuery">
            function <span class="apidocSignatureSpan">node-mysql.Table.prototype.</span>baseQuery
            <span class="apidocSignatureSpan">(str, bindings)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-mysql.Table.prototype.clone">
            function <span class="apidocSignatureSpan">node-mysql.Table.prototype.</span>clone
            <span class="apidocSignatureSpan">(conn, dto, cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-mysql.Table.prototype.create">
            function <span class="apidocSignatureSpan">node-mysql.Table.prototype.</span>create
            <span class="apidocSignatureSpan">(conn, dto, cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-mysql.Table.prototype.find">
            function <span class="apidocSignatureSpan">node-mysql.Table.prototype.</span>find
            <span class="apidocSignatureSpan">(conn, q, cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-mysql.Table.prototype.findAll">
            function <span class="apidocSignatureSpan">node-mysql.Table.prototype.</span>findAll
            <span class="apidocSignatureSpan">(conn, cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-mysql.Table.prototype.findById">
            function <span class="apidocSignatureSpan">node-mysql.Table.prototype.</span>findById
            <span class="apidocSignatureSpan">(conn, id, cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-mysql.Table.prototype.findFirst">
            function <span class="apidocSignatureSpan">node-mysql.Table.prototype.</span>findFirst
            <span class="apidocSignatureSpan">(conn, q, cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-mysql.Table.prototype.getCreatedFieldName">
            function <span class="apidocSignatureSpan">node-mysql.Table.prototype.</span>getCreatedFieldName
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-mysql.Table.prototype.getIdFieldName">
            function <span class="apidocSignatureSpan">node-mysql.Table.prototype.</span>getIdFieldName
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-mysql.Table.prototype.getName">
            function <span class="apidocSignatureSpan">node-mysql.Table.prototype.</span>getName
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-mysql.Table.prototype.getUpdatedFieldName">
            function <span class="apidocSignatureSpan">node-mysql.Table.prototype.</span>getUpdatedFieldName
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-mysql.Table.prototype.getVersionFieldName">
            function <span class="apidocSignatureSpan">node-mysql.Table.prototype.</span>getVersionFieldName
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-mysql.Table.prototype.linkedBy">
            function <span class="apidocSignatureSpan">node-mysql.Table.prototype.</span>linkedBy
            <span class="apidocSignatureSpan">(cfg)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-mysql.Table.prototype.linksTo">
            function <span class="apidocSignatureSpan">node-mysql.Table.prototype.</span>linksTo
            <span class="apidocSignatureSpan">(cfg)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-mysql.Table.prototype.lockById">
            function <span class="apidocSignatureSpan">node-mysql.Table.prototype.</span>lockById
            <span class="apidocSignatureSpan">(conn, id, cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-mysql.Table.prototype.relatesTo">
            function <span class="apidocSignatureSpan">node-mysql.Table.prototype.</span>relatesTo
            <span class="apidocSignatureSpan">(cfg)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.node-mysql.db">module node-mysql.db</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-mysql.db.db">
            function <span class="apidocSignatureSpan">node-mysql.</span>db
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-mysql.db.format">
            function <span class="apidocSignatureSpan">node-mysql.db.</span>format
            <span class="apidocSignatureSpan">(str, bindings)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.node-mysql.db.prototype">module node-mysql.db.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-mysql.db.prototype._buildCfg">
            function <span class="apidocSignatureSpan">node-mysql.db.prototype.</span>_buildCfg
            <span class="apidocSignatureSpan">(cfg, override)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-mysql.db.prototype._connect">
            function <span class="apidocSignatureSpan">node-mysql.db.prototype.</span>_connect
            <span class="apidocSignatureSpan">(pool, proc, cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-mysql.db.prototype._enterTransaction">
            function <span class="apidocSignatureSpan">node-mysql.db.prototype.</span>_enterTransaction
            <span class="apidocSignatureSpan">(conn)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-mysql.db.prototype._init">
            function <span class="apidocSignatureSpan">node-mysql.db.prototype.</span>_init
            <span class="apidocSignatureSpan">(cfg)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-mysql.db.prototype._isTxnConnection">
            function <span class="apidocSignatureSpan">node-mysql.db.prototype.</span>_isTxnConnection
            <span class="apidocSignatureSpan">(conn)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-mysql.db.prototype._leaveTransaction">
            function <span class="apidocSignatureSpan">node-mysql.db.prototype.</span>_leaveTransaction
            <span class="apidocSignatureSpan">(conn)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-mysql.db.prototype._prepare">
            function <span class="apidocSignatureSpan">node-mysql.db.prototype.</span>_prepare
            <span class="apidocSignatureSpan">(cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-mysql.db.prototype.connect">
            function <span class="apidocSignatureSpan">node-mysql.db.prototype.</span>connect
            <span class="apidocSignatureSpan">(proc, cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-mysql.db.prototype.cursor">
            function <span class="apidocSignatureSpan">node-mysql.db.prototype.</span>cursor
            <span class="apidocSignatureSpan">(q, proc, _cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-mysql.db.prototype.end">
            function <span class="apidocSignatureSpan">node-mysql.db.prototype.</span>end
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-mysql.db.prototype.getConnection">
            function <span class="apidocSignatureSpan">node-mysql.db.prototype.</span>getConnection
            <span class="apidocSignatureSpan">(cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-mysql.db.prototype.transaction">
            function <span class="apidocSignatureSpan">node-mysql.db.prototype.</span>transaction
            <span class="apidocSignatureSpan">(conn, proc, cb)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.node-mysql.model">module node-mysql.model</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-mysql.model.Row">
            function <span class="apidocSignatureSpan">node-mysql.model.</span>Row
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-mysql.model.Table">
            function <span class="apidocSignatureSpan">node-mysql.model.</span>Table
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">string <span class="apidocSignatureSpan">node-mysql.model.</span>OPTIMISTIC_LOCK_EXCEPTION</span>

        </li>

    </ol></li>

</ol></div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.node-mysql" id="apidoc.module.node-mysql">module node-mysql</a></h1>


    <h2>
        <a href="#apidoc.element.node-mysql.DB" id="apidoc.element.node-mysql.DB">
        function <span class="apidocSignatureSpan">node-mysql.</span>DB
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">DB = function () {
    this._init.apply(this, arguments);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-mysql.Row" id="apidoc.element.node-mysql.Row">
        function <span class="apidocSignatureSpan">node-mysql.</span>Row
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">Row = function () {
    this._init.apply(this, arguments);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
var q = 'select * from users';

db.cursor(q, function(row, cb) {
    cps.rescur({
        'try': function() {
            cps.seq([
                function(_, cb) {
                    var user = new User.<span class="apidocCodeKeywordSpan">Row</span>(row);
                    user.update(conn, {active: 1}, cb);
                },
                function(res, cb) {
                    console.log(res);
                    cb();
                }
            ], cb);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-mysql.Table" id="apidoc.element.node-mysql.Table">
        function <span class="apidocSignatureSpan">node-mysql.</span>Table
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">Table = function () {
    this._init.apply(this, arguments);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-mysql.db" id="apidoc.element.node-mysql.db">
        function <span class="apidocSignatureSpan">node-mysql.</span>db
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">db = function () {
    this._init.apply(this, arguments);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>














</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.node-mysql.DB" id="apidoc.module.node-mysql.DB">module node-mysql.DB</a></h1>


    <h2>
        <a href="#apidoc.element.node-mysql.DB.DB" id="apidoc.element.node-mysql.DB.DB">
        function <span class="apidocSignatureSpan">node-mysql.</span>DB
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">DB = function () {
    this._init.apply(this, arguments);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-mysql.DB.format" id="apidoc.element.node-mysql.DB.format">
        function <span class="apidocSignatureSpan">node-mysql.DB.</span>format
        <span class="apidocSignatureSpan">(str, bindings)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">format = function (str, bindings) {
    var l = str.split('?')

    if (l.length - 1 != bindings.length) {
        throw new Error('sql string format error');
    }

    var res = [];

    for (var i = 0; i &lt; bindings.length; i++) {
        res.push(l[i]);
        res.push(mysql.escape(bindings[i]));
    }

    res.push(l[l.length - 1]);

    return res.join(' ');
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
        }
    ], cb);
}, cb);
```


&lt;a name="DB-format" /&gt;
### DB.<span class="apidocCodeKeywordSpan">format</span>(query_string, variable_bindings)

This is a wrapper of the query string formatting functionality
provided by the mysql package.  Note that this is a global static
method defined on the class DB.  It is NOT an instance method defined
a a DB instance db.

__Example__
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.node-mysql.DB.prototype" id="apidoc.module.node-mysql.DB.prototype">module node-mysql.DB.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.node-mysql.DB.prototype._init" id="apidoc.element.node-mysql.DB.prototype._init">
        function <span class="apidocSignatureSpan">node-mysql.DB.prototype.</span>_init
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_init = function () {
    var tmp = this.parent;
    this.parent = superclass.prototype;
    var res = fn.apply(this, arguments);
    this.parent = tmp;
    return res;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-mysql.DB.prototype.add" id="apidoc.element.node-mysql.DB.prototype.add">
        function <span class="apidocSignatureSpan">node-mysql.DB.prototype.</span>add
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">add = function () {
    var tmp = this.parent;
    this.parent = superclass.prototype;
    var res = fn.apply(this, arguments);
    this.parent = tmp;
    return res;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
&lt;a name="db-end" /&gt;
### db.end();

This function destructs the db object.

&lt;a name="db-add"/&gt;

### db.<span class="apidocCodeKeywordSpan">add</span>(config);

This function is used to define a model that belongs to the db object.  The model config object is of the following format:

```json
{
"name": {
    "type": "String",
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-mysql.DB.prototype.clone" id="apidoc.element.node-mysql.DB.prototype.clone">
        function <span class="apidocSignatureSpan">node-mysql.DB.prototype.</span>clone
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">clone = function () {
    var tmp = this.parent;
    this.parent = superclass.prototype;
    var res = fn.apply(this, arguments);
    this.parent = tmp;
    return res;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
* version

All of the these fields will be filled by the invocation to table.create.


&lt;a name="table-clone"/&gt;

### table.<span class="apidocCodeKeywordSpan">clone</span>(database_connection, data_object, callback)

This API is very similar to table.create.  The key difference is that
it does not mask out any data field carried in data_object.  Instead,
it literally uses every thing in data_object to create a new row.  In
other words, it'll honor the values of the following fields in
data_object:
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-mysql.DB.prototype.extend" id="apidoc.element.node-mysql.DB.prototype.extend">
        function <span class="apidocSignatureSpan">node-mysql.DB.prototype.</span>extend
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">extend = function () {
    var tmp = this.parent;
    this.parent = superclass.prototype;
    var res = fn.apply(this, arguments);
    this.parent = tmp;
    return res;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
        _buildCfg: function(cfg, override) {
var res = {};

for (var k in cfg) {
    res[k] = cfg[k];
}

$U.<span class="apidocCodeKeywordSpan">extend</span>(res, override);
return res;
        },

        connect: function(proc, cb) {
var me = this;

cps.seq([
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-mysql.DB.prototype.get" id="apidoc.element.node-mysql.DB.prototype.get">
        function <span class="apidocSignatureSpan">node-mysql.DB.prototype.</span>get
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">get = function () {
    var tmp = this.parent;
    this.parent = superclass.prototype;
    var res = fn.apply(this, arguments);
    this.parent = tmp;
    return res;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
* We created a model for the table "orders" in the database.
* We add a method getFirstOrderItem into the Row class of this model.
* We add a method createOrderWithCoupon into the Table class of this model.
* We follow the foreign key relations of the "orders" table to define some link relations.

&lt;a name="db-get"/&gt;

### db.<span class="apidocCodeKeywordSpan">get</span>(table_name)

Once you use db.add to create a model in the db object, you can then
use db.get to retrieve it by name.  The return value of
db.get if a object of the following format:

```json
{
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.node-mysql.Row" id="apidoc.module.node-mysql.Row">module node-mysql.Row</a></h1>


    <h2>
        <a href="#apidoc.element.node-mysql.Row.Row" id="apidoc.element.node-mysql.Row.Row">
        function <span class="apidocSignatureSpan">node-mysql.</span>Row
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">Row = function () {
    this._init.apply(this, arguments);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
var q = 'select * from users';

db.cursor(q, function(row, cb) {
    cps.rescur({
        'try': function() {
            cps.seq([
                function(_, cb) {
                    var user = new User.<span class="apidocCodeKeywordSpan">Row</span>(row);
                    user.update(conn, {active: 1}, cb);
                },
                function(res, cb) {
                    console.log(res);
                    cb();
                }
            ], cb);
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.node-mysql.Row.prototype" id="apidoc.module.node-mysql.Row.prototype">module node-mysql.Row.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.node-mysql.Row.prototype._getVersion" id="apidoc.element.node-mysql.Row.prototype._getVersion">
        function <span class="apidocSignatureSpan">node-mysql.Row.prototype.</span>_getVersion
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_getVersion = function () {
    return this._data[this._table.getVersionFieldName()];
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
this._update(conn, dto, null, cb);
        },

        update: function(conn, dto, cb) {
var me = this;

dto['version'] = this._nextVersion();
var cond = DB.format('version = ?', [this.<span class="apidocCodeKeywordSpan">_getVersion</span>()]);

cps.seq([
    function(_, cb) {
        me._update(conn, dto, cond, cb);
    },
    function(res, cb) {
        if (res.changedRows === 0) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-mysql.Row.prototype._init" id="apidoc.element.node-mysql.Row.prototype._init">
        function <span class="apidocSignatureSpan">node-mysql.Row.prototype.</span>_init
        <span class="apidocSignatureSpan">(data, cfg)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_init = function (data, cfg) {
    this._table = cfg.table;
    this._data = data;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-mysql.Row.prototype._load" id="apidoc.element.node-mysql.Row.prototype._load">
        function <span class="apidocSignatureSpan">node-mysql.Row.prototype.</span>_load
        <span class="apidocSignatureSpan">(conn, name, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_load = function (conn, name, cb) {
    var cfg = this._table._lookupLinksToMap(name);
    if (cfg) {
        return this.linksTo(conn, name, cb);
    }

    var cfg = this._table._lookupLinkedByMap(name);
    if (cfg) {
        return this.linkedBy(conn, name, cb);
    }

    var cfg = this._table._lookupRelatesToMap(name);
    if (cfg) {
        return this.relatesTo(conn, name, cb);
    }

    throw new Error('no linksTo or linkedBy or relatesTo: ' + name + ' defined on: ' + this._table.getName());
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
        },

        load: function(conn, name, cb) {
var value = this.get(name);
if (value) {
    cb(null, value);
} else {
    this.<span class="apidocCodeKeywordSpan">_load</span>(conn, name, cb);
}
        },

        linksTo: function(conn, name, cb) {
var me = this;

var cfg = this._table._lookupLinksToMap(name);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-mysql.Row.prototype._nextVersion" id="apidoc.element.node-mysql.Row.prototype._nextVersion">
        function <span class="apidocSignatureSpan">node-mysql.Row.prototype.</span>_nextVersion
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_nextVersion = function () {
    return this._data[this._table.getVersionFieldName()] + 1;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
        updateWithoutOptimisticLock: function(conn, dto, cb) {
this._update(conn, dto, null, cb);
        },

        update: function(conn, dto, cb) {
var me = this;

dto['version'] = this.<span class="apidocCodeKeywordSpan">_nextVersion</span>();
var cond = DB.format('version = ?', [this._getVersion()]);

cps.seq([
    function(_, cb) {
        me._update(conn, dto, cond, cb);
    },
    function(res, cb) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-mysql.Row.prototype._refineDtoForUpdate" id="apidoc.element.node-mysql.Row.prototype._refineDtoForUpdate">
        function <span class="apidocSignatureSpan">node-mysql.Row.prototype.</span>_refineDtoForUpdate
        <span class="apidocSignatureSpan">(dto)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_refineDtoForUpdate = function (dto) {

    var res = {};

    for (var k in dto) {
        if (this._table._hasUpdatableField(k)) {
            res[k] = dto[k];
        }
    }

    var d = new Date();
    res[this._table.getUpdatedFieldName()] = d;

    return res;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
], cb);
        },

        _update: function(conn, dto, conditions, cb) {
var me = this;

// dto[this._table.getUpdatedFieldName()] = new Date();
dto = this.<span class="apidocCodeKeywordSpan">_refineDtoForUpdate</span>(dto);

var l = [
    ' update ', this._table.getName(), ' set '
];

var first = true;
for (var k in dto) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-mysql.Row.prototype._update" id="apidoc.element.node-mysql.Row.prototype._update">
        function <span class="apidocSignatureSpan">node-mysql.Row.prototype.</span>_update
        <span class="apidocSignatureSpan">(conn, dto, conditions, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_update = function (conn, dto, conditions, cb) {
    var me = this;

    // dto[this._table.getUpdatedFieldName()] = new Date();
    dto = this._refineDtoForUpdate(dto);

    var l = [
        ' update ', this._table.getName(), ' set '
    ];

    var first = true;
    for (var k in dto) {
        var v = dto[k];
        if (first) {
            first = false;
        } else {
            l.push(', ');
        }
        l.push(
            ' ', k, ' = ', conn.escape(v)
        );
    }

    l.push(
        ' where ', this._table.getIdFieldName(), ' = ', this.getId()
    );

    if (conditions) {
        l.push(
            ' and ', conditions
        );
    }

    l.push(' ; ');

    var q = l.join('');

    // console.log(q);

    cps.seq([
        function(_, cb) {
            conn.query(q, cb);
        },
        function(res, cb) {
            me._updateLocalData(dto);
            cb(null, res);
        }
    ], cb);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
var d = new Date();
res[this._table.getUpdatedFieldName()] = d;

return res;
        },

        updateWithoutOptimisticLock: function(conn, dto, cb) {
this.<span class="apidocCodeKeywordSpan">_update</span>(conn, dto, null, cb);
        },

        update: function(conn, dto, cb) {
var me = this;

dto['version'] = this._nextVersion();
var cond = DB.format('version = ?', [this._getVersion()]);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-mysql.Row.prototype._updateLocalData" id="apidoc.element.node-mysql.Row.prototype._updateLocalData">
        function <span class="apidocSignatureSpan">node-mysql.Row.prototype.</span>_updateLocalData
        <span class="apidocSignatureSpan">(dto)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_updateLocalData = function (dto) {
    for (var k in dto) {
        var v = dto[k];
        this._data[k] = v;
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    // console.log(q);

    cps.seq([
        function(_, cb) {
            conn.query(q, cb);
        },
        function(res, cb) {
            me.<span class="apidocCodeKeywordSpan">_updateLocalData</span>(dto);
            cb(null, res);
        }
    ], cb);
},

get: function(fieldName) {
    return this._data[fieldName]
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-mysql.Row.prototype.get" id="apidoc.element.node-mysql.Row.prototype.get">
        function <span class="apidocSignatureSpan">node-mysql.Row.prototype.</span>get
        <span class="apidocSignatureSpan">(fieldName)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">get = function (fieldName) {
    return this._data[fieldName]
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
* We created a model for the table "orders" in the database.
* We add a method getFirstOrderItem into the Row class of this model.
* We add a method createOrderWithCoupon into the Table class of this model.
* We follow the foreign key relations of the "orders" table to define some link relations.

&lt;a name="db-get"/&gt;

### db.<span class="apidocCodeKeywordSpan">get</span>(table_name)

Once you use db.add to create a model in the db object, you can then
use db.get to retrieve it by name.  The return value of
db.get if a object of the following format:

```json
{
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-mysql.Row.prototype.getId" id="apidoc.element.node-mysql.Row.prototype.getId">
        function <span class="apidocSignatureSpan">node-mysql.Row.prototype.</span>getId
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">getId = function () {
    return this._data[this._table.getIdFieldName()];
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
                cb(null, items[0]);
            }
        ], cb);
    }
},
Table: {
    createOrderUsingCoupon: function(conn, dto, coupon, cb) {
        dto['coupon_id'] = coupon.<span class="apidocCodeKeywordSpan">getId</span>();
        this.create(conn, dto, cb);
    }
}
})
.linkedBy({
    name: 'items',
    key: 'order_id',
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-mysql.Row.prototype.linkedBy" id="apidoc.element.node-mysql.Row.prototype.linkedBy">
        function <span class="apidocSignatureSpan">node-mysql.Row.prototype.</span>linkedBy
        <span class="apidocSignatureSpan">(conn, name, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">linkedBy = function (conn, name, cb) {
    var me = this;

    var cfg = this._table._lookupLinkedByMap(name);

    if (cfg) {
        var otherTable = this._table._db.get(cfg.table).Table;
        return cps.seq([
            function(_, cb) {
                otherTable.find(conn, otherTable.baseQuery('where ' + cfg.key + ' = ?', [me.getId()]), cb);
            },
            function(res, cb) {
                me._data[cfg.name] = res;
                cb(null, me._data[cfg.name]);
            }
        ], cb);
    } else {
        throw new Error('no linkedBy: ' + name + ' defined on: ' + this._table.getName());
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
idFieldName: 'order_id',
Row: {
    getFirstOrderItem: function(conn, cb) {
        var me = this;

        cps.seq([
            function(_, cb) {
                me.<span class="apidocCodeKeywordSpan">linkedBy</span>(conn, 'items', cb);
            },
            function(items, cb) {
                cb(null, items[0]);
            }
        ], cb);
    }
},
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-mysql.Row.prototype.linksTo" id="apidoc.element.node-mysql.Row.prototype.linksTo">
        function <span class="apidocSignatureSpan">node-mysql.Row.prototype.</span>linksTo
        <span class="apidocSignatureSpan">(conn, name, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">linksTo = function (conn, name, cb) {
    var me = this;

    var cfg = this._table._lookupLinksToMap(name);

    if (cfg) {
        var otherTable = this._table._db.get(cfg.table).Table;
        return cps.seq([
            function(_, cb) {
                otherTable.findById(conn, me.get(cfg.key), cb);
            },
            function(res, cb) {
                me._data[cfg.name] = res;
                cb(null, res);
            }
        ], cb);
    } else {
        throw new Error('no linksTo: ' + name + ' defined on: ' + this._table.getName());
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
}
})
.linkedBy({
    name: 'items',
    key: 'order_id',
    table: 'order_items'
})
.<span class="apidocCodeKeywordSpan">linksTo</span>({
    name: 'user',
    key: 'user_id',
    table: 'users'
})
.linksTo({
    name: 'coupon',
    key: 'coupon_id',
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-mysql.Row.prototype.load" id="apidoc.element.node-mysql.Row.prototype.load">
        function <span class="apidocSignatureSpan">node-mysql.Row.prototype.</span>load
        <span class="apidocSignatureSpan">(conn, name, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">load = function (conn, name, cb) {
    var value = this.get(name);
    if (value) {
        cb(null, value);
    } else {
        this._load(conn, name, cb);
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-mysql.Row.prototype.relatesTo" id="apidoc.element.node-mysql.Row.prototype.relatesTo">
        function <span class="apidocSignatureSpan">node-mysql.Row.prototype.</span>relatesTo
        <span class="apidocSignatureSpan">(conn, name, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">relatesTo = function (conn, name, cb) {
    var me = this;

    var cfg = this._table._lookupRelatesToMap(name);
    if (cfg) {
        var otherTable = this._table._db.get(cfg.table).Table;
        var throughTable = this._table._db.get(cfg.through).Table;

        return cps.seq([
            function(_, cb) {
                var _q = 'select t.* from ' +
                        otherTable.getName()  + ' t, ' +
                        throughTable.getName() + ' r where ' +
                        'r.' + cfg['leftKey'] + ' = ? and ' +
                        'r.' + cfg['rightKey'] + ' = t.' + otherTable.getIdFieldName()
                    ;
                var q = DB.format(_q, [me.getId()]);
                otherTable.find(conn, q, cb);
            },
            function(res, cb) {
                me._data[cfg.name] = res;
                cb(null, me._data[cfg.name]);
            }
        ], cb);
    } else {
        throw new Error('no relatesTo: ' + name + ' defined on: ' + this._table.getName());
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

Once a "linkedBy" is set up on a table, a row object corresponding to
this table can call the "linkedBy" method to pull more (associated)
data into the row.  See examples [here](#row-linkedBy).

&lt;a name="table-relatesTo"/&gt;

### table.<span class="apidocCodeKeywordSpan">relatesTo</span>(config)

The config object has the following schema:

```json
{
"name": {
    "type": "String",
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-mysql.Row.prototype.update" id="apidoc.element.node-mysql.Row.prototype.update">
        function <span class="apidocSignatureSpan">node-mysql.Row.prototype.</span>update
        <span class="apidocSignatureSpan">(conn, dto, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">update = function (conn, dto, cb) {
    var me = this;

    dto['version'] = this._nextVersion();
    var cond = DB.format('version = ?', [this._getVersion()]);

    cps.seq([
        function(_, cb) {
            me._update(conn, dto, cond, cb);
        },
        function(res, cb) {
            if (res.changedRows === 0) {
                throw new Error(Model.OPTIMISTIC_LOCK_EXCEPTION);
            } else {
                cb(null, res);
            }
        }
    ], cb);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

        db.cursor(q, function(row, cb) {
cps.rescur({
    'try': function() {
        cps.seq([
            function(_, cb) {
                var user = new User.Row(row);
                user.<span class="apidocCodeKeywordSpan">update</span>(conn, {active: 1}, cb);
            },
            function(res, cb) {
                console.log(res);
                cb();
            }
        ], cb);
    },
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-mysql.Row.prototype.updateWithoutOptimisticLock" id="apidoc.element.node-mysql.Row.prototype.updateWithoutOptimisticLock">
        function <span class="apidocSignatureSpan">node-mysql.Row.prototype.</span>updateWithoutOptimisticLock
        <span class="apidocSignatureSpan">(conn, dto, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">updateWithoutOptimisticLock = function (conn, dto, cb) {
    this._update(conn, dto, null, cb);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
            }
        ], cb);
    }, cb);
};
```

&lt;a name="row-updateWithoutOptimisticLock"/&gt;
### row.<span class="apidocCodeKeywordSpan">updateWithoutOptimisticLock</span>(database_connection, update_object, callback)

This function is the same as row.update with only one difference: it
does not care about the optimistic lock version field.  It neither
looks at this field nor update field.  This might be useful
ocasionally when optimistic lock functionality needs to be overriden.
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.node-mysql.Table" id="apidoc.module.node-mysql.Table">module node-mysql.Table</a></h1>


    <h2>
        <a href="#apidoc.element.node-mysql.Table.Table" id="apidoc.element.node-mysql.Table.Table">
        function <span class="apidocSignatureSpan">node-mysql.</span>Table
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">Table = function () {
    this._init.apply(this, arguments);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.node-mysql.Table.prototype" id="apidoc.module.node-mysql.Table.prototype">module node-mysql.Table.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.node-mysql.Table.prototype._create" id="apidoc.element.node-mysql.Table.prototype._create">
        function <span class="apidocSignatureSpan">node-mysql.Table.prototype.</span>_create
        <span class="apidocSignatureSpan">(conn, dto, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_create = function (conn, dto, cb) {
    var me = this;

    var l = [
        ' insert into ' + this.getName() + ' set '
    ];

    var first = true;

    $U.each(dto, function(v, k) {
        if (first) {
            first = false;
        } else {
            l.push(', ');
        }
        l.push(
            ' ', k, ' = ', conn.escape(v)
        );
    });

    l.push(' ; ');

    var q = l.join('');

    // console.log(q);

    cps.seq([
        function(_, cb) {
            conn.query(q, cb);
        },
        function(res, cb) {
            dto[me._idFieldName] = res.insertId;
            cb(null, new me._rowClass(dto));
        }
    ], cb);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
res[this.getVersionFieldName()] = 0;

return res;
        },

        create: function(conn, dto, cb) {
dto = this._refineDtoForCreate(dto);
this.<span class="apidocCodeKeywordSpan">_create</span>(conn, dto, cb);
        },

        _create: function(conn, dto, cb) {
var me = this;

var l = [
    ' insert into ' + this.getName() + ' set '
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-mysql.Table.prototype._hasUpdatableField" id="apidoc.element.node-mysql.Table.prototype._hasUpdatableField">
        function <span class="apidocSignatureSpan">node-mysql.Table.prototype.</span>_hasUpdatableField
        <span class="apidocSignatureSpan">(field)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_hasUpdatableField = function (field) {
    if (field == this.getIdFieldName()) {
        return false;
    }
    if (field == this.getCreatedFieldName()) {
        return false;
    }
    var schema = this._db._schema[this.getName()];
    return $U.contains(schema, field);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
        },

        _refineDtoForUpdate: function(dto) {

var res = {};

for (var k in dto) {
    if (this._table.<span class="apidocCodeKeywordSpan">_hasUpdatableField</span>(k)) {
        res[k] = dto[k];
    }
}

var d = new Date();
res[this._table.getUpdatedFieldName()] = d;
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-mysql.Table.prototype._init" id="apidoc.element.node-mysql.Table.prototype._init">
        function <span class="apidocSignatureSpan">node-mysql.Table.prototype.</span>_init
        <span class="apidocSignatureSpan">(cfg)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_init = function (cfg) {
    this._name = cfg.name;
    this._idFieldName = cfg.idFieldName || 'id';
    this._versionFieldName = cfg.versionFieldName || 'version';
    this._createdFieldName = cfg.createdFieldName || 'date_created';
    this._updatedFieldName = cfg.updatedFieldName || 'last_updated';

    this._rowClass = cfg['rowClass'];
    // this._schema = cfg['schema'];
    this._db = cfg['db'];

    this._linksToMap = {};
    this._linkedByMap = {};
    this._relatesToMap = {};
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-mysql.Table.prototype._lookupLinkedByMap" id="apidoc.element.node-mysql.Table.prototype._lookupLinkedByMap">
        function <span class="apidocSignatureSpan">node-mysql.Table.prototype.</span>_lookupLinkedByMap
        <span class="apidocSignatureSpan">(name)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_lookupLinkedByMap = function (name) {
    var cfg = this._linkedByMap[name];
    if (cfg) {
        cfg.name = name;
    }
    return cfg;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

        _load: function(conn, name, cb) {
var cfg = this._table._lookupLinksToMap(name);
if (cfg) {
    return this.linksTo(conn, name, cb);
}

var cfg = this._table.<span class="apidocCodeKeywordSpan">_lookupLinkedByMap</span>(name);
if (cfg) {
    return this.linkedBy(conn, name, cb);
}

var cfg = this._table._lookupRelatesToMap(name);
if (cfg) {
    return this.relatesTo(conn, name, cb);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-mysql.Table.prototype._lookupLinksToMap" id="apidoc.element.node-mysql.Table.prototype._lookupLinksToMap">
        function <span class="apidocSignatureSpan">node-mysql.Table.prototype.</span>_lookupLinksToMap
        <span class="apidocSignatureSpan">(name)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_lookupLinksToMap = function (name) {
    var cfg = this._linksToMap[name];
    if (cfg) {
        cfg.name = name;
    }
    return cfg;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
        },

        get: function(fieldName) {
return this._data[fieldName]
        },

        _load: function(conn, name, cb) {
var cfg = this._table.<span class="apidocCodeKeywordSpan">_lookupLinksToMap</span>(name);
if (cfg) {
    return this.linksTo(conn, name, cb);
}

var cfg = this._table._lookupLinkedByMap(name);
if (cfg) {
    return this.linkedBy(conn, name, cb);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-mysql.Table.prototype._lookupRelatesToMap" id="apidoc.element.node-mysql.Table.prototype._lookupRelatesToMap">
        function <span class="apidocSignatureSpan">node-mysql.Table.prototype.</span>_lookupRelatesToMap
        <span class="apidocSignatureSpan">(name)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_lookupRelatesToMap = function (name) {
    var cfg = this._relatesToMap[name];
    if (cfg) {
        cfg.name = name;
    }
    return cfg;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    }

    var cfg = this._table._lookupLinkedByMap(name);
    if (cfg) {
        return this.linkedBy(conn, name, cb);
    }

    var cfg = this._table.<span class="apidocCodeKeywordSpan">_lookupRelatesToMap</span>(name);
    if (cfg) {
        return this.relatesTo(conn, name, cb);
    }

    throw new Error('no linksTo or linkedBy or relatesTo: ' + name + ' defined on: ' + this._table.getName());
},
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-mysql.Table.prototype._refineDto" id="apidoc.element.node-mysql.Table.prototype._refineDto">
        function <span class="apidocSignatureSpan">node-mysql.Table.prototype.</span>_refineDto
        <span class="apidocSignatureSpan">(dto, autoId)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_refineDto = function (dto, autoId) {
    autoId = (autoId === undefined)? true: autoId;
    var res = {};

    var schema = this._db._schema[this.getName()];
    $U.each(schema, function(field) {
        res[field] = dto[field];
    });

    if (autoId) {
        delete res[this.getIdFieldName()];
    }

    return res;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    delete res[this.getIdFieldName()];
}

return res;
        },

        _refineDtoForCreate: function(dto) {
var res = this.<span class="apidocCodeKeywordSpan">_refineDto</span>(dto);

var d = new Date();
res[this.getCreatedFieldName()] = d;
res[this.getUpdatedFieldName()] = d;
res[this.getVersionFieldName()] = 0;

return res;
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-mysql.Table.prototype._refineDtoForCreate" id="apidoc.element.node-mysql.Table.prototype._refineDtoForCreate">
        function <span class="apidocSignatureSpan">node-mysql.Table.prototype.</span>_refineDtoForCreate
        <span class="apidocSignatureSpan">(dto)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_refineDtoForCreate = function (dto) {
    var res = this._refineDto(dto);

    var d = new Date();
    res[this.getCreatedFieldName()] = d;
    res[this.getUpdatedFieldName()] = d;
    res[this.getVersionFieldName()] = 0;

    return res;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
res[this.getUpdatedFieldName()] = d;
res[this.getVersionFieldName()] = 0;

return res;
        },

        create: function(conn, dto, cb) {
dto = this.<span class="apidocCodeKeywordSpan">_refineDtoForCreate</span>(dto);
this._create(conn, dto, cb);
        },

        _create: function(conn, dto, cb) {
var me = this;

var l = [
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-mysql.Table.prototype.baseQuery" id="apidoc.element.node-mysql.Table.prototype.baseQuery">
        function <span class="apidocSignatureSpan">node-mysql.Table.prototype.</span>baseQuery
        <span class="apidocSignatureSpan">(str, bindings)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">baseQuery = function (str, bindings) {
    var q = ' select * from ' + this.getName() + ' ';
    var further;

    if (str != null) {
        if (bindings == null) {
            further = str;
        } else {
            further = DB.format(str, bindings);
        }
    }

    if (further != null) {
        q += further;
    }
    return q;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

&lt;a name="table-findAll"/&gt;
### table.findAll(database_connection, callback)

This finds all the rows in a table.

&lt;a name="table-baseQuery"/&gt;
### table.<span class="apidocCodeKeywordSpan">baseQuery</span>(query_string, variable_bindings)

This is a short-hand for:

```javascript
DB.format('select * from table_name' + query_string, variable_bindings);
```
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-mysql.Table.prototype.clone" id="apidoc.element.node-mysql.Table.prototype.clone">
        function <span class="apidocSignatureSpan">node-mysql.Table.prototype.</span>clone
        <span class="apidocSignatureSpan">(conn, dto, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">clone = function (conn, dto, cb) {
    dto = this._refineDto(dto, false);
    this._create(conn, dto, cb);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
* version

All of the these fields will be filled by the invocation to table.create.


&lt;a name="table-clone"/&gt;

### table.<span class="apidocCodeKeywordSpan">clone</span>(database_connection, data_object, callback)

This API is very similar to table.create.  The key difference is that
it does not mask out any data field carried in data_object.  Instead,
it literally uses every thing in data_object to create a new row.  In
other words, it'll honor the values of the following fields in
data_object:
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-mysql.Table.prototype.create" id="apidoc.element.node-mysql.Table.prototype.create">
        function <span class="apidocSignatureSpan">node-mysql.Table.prototype.</span>create
        <span class="apidocSignatureSpan">(conn, dto, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">create = function (conn, dto, cb) {
    dto = this._refineDtoForCreate(dto);
    this._create(conn, dto, cb);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
function(
    conn/*A new transactional connection is
          created to handle the transactional session.*/,
    cb
) {
    cps.seq([
        function(_, cb) {
            Model.Table.<span class="apidocCodeKeywordSpan">create</span>(conn, getSampleDto(), cb);
        },
        function(_, cb) {
            dw.transaction(
                conn/*This is already a transactional connection.*/,
                function(
                    conn/*No new transactional connection created.
                          This connection is the same one as
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-mysql.Table.prototype.find" id="apidoc.element.node-mysql.Table.prototype.find">
        function <span class="apidocSignatureSpan">node-mysql.Table.prototype.</span>find
        <span class="apidocSignatureSpan">(conn, q, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">find = function (conn, q, cb) {
    var me = this;

    cps.seq([
        function(_, cb) {
            conn.query(q, cb);
        },
        function(res, cb) {
            cb(null, $U.map(res, function(o) {
                return new me._rowClass(o);
            }));
        }
    ], cb);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
* last_udpated
* version

This API can be useful when one attempts to clone a row in a table
literally to another table (which might be in another database).

&lt;a name="table-find"/&gt;
### table.<span class="apidocCodeKeywordSpan">find</span>(database_connection, query_string, callback)

This function is not too different from doing a query directly on a
database connection.  The only extra thing it does is to turn the
result from a list of simple hash objects to a list of Row objects of
the corresponding table's "rowClass".

__Example__
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-mysql.Table.prototype.findAll" id="apidoc.element.node-mysql.Table.prototype.findAll">
        function <span class="apidocSignatureSpan">node-mysql.Table.prototype.</span>findAll
        <span class="apidocSignatureSpan">(conn, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">findAll = function (conn, cb) {
    this.find(conn, this.baseQuery(), cb);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
```

In this example, two threads are executed in parallel.  The thread of
setting value "bar1" will be block by the thread of setting value
"foo1".

&lt;a name="table-findAll"/&gt;
### table.<span class="apidocCodeKeywordSpan">findAll</span>(database_connection, callback)

This finds all the rows in a table.

&lt;a name="table-baseQuery"/&gt;
### table.baseQuery(query_string, variable_bindings)

This is a short-hand for:
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-mysql.Table.prototype.findById" id="apidoc.element.node-mysql.Table.prototype.findById">
        function <span class="apidocSignatureSpan">node-mysql.Table.prototype.</span>findById
        <span class="apidocSignatureSpan">(conn, id, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">findById = function (conn, id, cb) {
    var me = this;

    cps.seq([
        function(_, cb) {
            me.find(conn, me.baseQuery('where ' + me.getIdFieldName() + ' = ? ', [id]), cb);
        },
        function(res) {
            cb(null, res[0])
        }
    ], cb);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
        cb();
    }
], cb);
}, cb);
```

&lt;a name="table-findById"/&gt;
### table.<span class="apidocCodeKeywordSpan">findById</span>(database_connection, row_id, callback)

This is simply a short-hand for:

```javascript
cps.seq([
function(_, cb) {
    table.find(
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-mysql.Table.prototype.findFirst" id="apidoc.element.node-mysql.Table.prototype.findFirst">
        function <span class="apidocSignatureSpan">node-mysql.Table.prototype.</span>findFirst
        <span class="apidocSignatureSpan">(conn, q, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">findFirst = function (conn, q, cb) {
    var me = this;

    cps.seq([
        function(_, cb) {
            me.find(conn, q, cb);
        },
        function(res, cb) {
            cb(null, res[0]);
        }
    ], cb);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-mysql.Table.prototype.getCreatedFieldName" id="apidoc.element.node-mysql.Table.prototype.getCreatedFieldName">
        function <span class="apidocSignatureSpan">node-mysql.Table.prototype.</span>getCreatedFieldName
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">getCreatedFieldName = function () {
    return this._createdFieldName;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    return this._updatedFieldName;
},

_hasUpdatableField: function(field) {
    if (field == this.getIdFieldName()) {
        return false;
    }
    if (field == this.<span class="apidocCodeKeywordSpan">getCreatedFieldName</span>()) {
        return false;
    }
    var schema = this._db._schema[this.getName()];
    return $U.contains(schema, field);
},

_refineDto: function(dto, autoId) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-mysql.Table.prototype.getIdFieldName" id="apidoc.element.node-mysql.Table.prototype.getIdFieldName">
        function <span class="apidocSignatureSpan">node-mysql.Table.prototype.</span>getIdFieldName
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">getIdFieldName = function () {
    return this._idFieldName;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    var Row  = Class({
_init: function(data, cfg) {
    this._table = cfg.table;
    this._data = data;
},

getId: function() {
    return this._data[this._table.<span class="apidocCodeKeywordSpan">getIdFieldName</span>()];
},

_getVersion: function() {
    return this._data[this._table.getVersionFieldName()];
},

_nextVersion: function() {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-mysql.Table.prototype.getName" id="apidoc.element.node-mysql.Table.prototype.getName">
        function <span class="apidocSignatureSpan">node-mysql.Table.prototype.</span>getName
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">getName = function () {
    return this._name;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
        _update: function(conn, dto, conditions, cb) {
var me = this;

// dto[this._table.getUpdatedFieldName()] = new Date();
dto = this._refineDtoForUpdate(dto);

var l = [
    ' update ', this._table.<span class="apidocCodeKeywordSpan">getName</span>(), ' set '
];

var first = true;
for (var k in dto) {
    var v = dto[k];
    if (first) {
        first = false;
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-mysql.Table.prototype.getUpdatedFieldName" id="apidoc.element.node-mysql.Table.prototype.getUpdatedFieldName">
        function <span class="apidocSignatureSpan">node-mysql.Table.prototype.</span>getUpdatedFieldName
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">getUpdatedFieldName = function () {
    return this._updatedFieldName;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    for (var k in dto) {
        if (this._table._hasUpdatableField(k)) {
            res[k] = dto[k];
        }
    }

    var d = new Date();
    res[this._table.<span class="apidocCodeKeywordSpan">getUpdatedFieldName</span>()] = d;

    return res;
},

updateWithoutOptimisticLock: function(conn, dto, cb) {
    this._update(conn, dto, null, cb);
},
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-mysql.Table.prototype.getVersionFieldName" id="apidoc.element.node-mysql.Table.prototype.getVersionFieldName">
        function <span class="apidocSignatureSpan">node-mysql.Table.prototype.</span>getVersionFieldName
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">getVersionFieldName = function () {
    return this._versionFieldName;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
},

getId: function() {
    return this._data[this._table.getIdFieldName()];
},

_getVersion: function() {
    return this._data[this._table.<span class="apidocCodeKeywordSpan">getVersionFieldName</span>()];
},

_nextVersion: function() {
    return this._data[this._table.getVersionFieldName()] + 1;
},

_updateLocalData: function(dto) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-mysql.Table.prototype.linkedBy" id="apidoc.element.node-mysql.Table.prototype.linkedBy">
        function <span class="apidocSignatureSpan">node-mysql.Table.prototype.</span>linkedBy
        <span class="apidocSignatureSpan">(cfg)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">linkedBy = function (cfg) {
    this._linkedByMap[cfg.name] = {
        table: cfg.table,
        key: cfg.key
    };
    return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
idFieldName: 'order_id',
Row: {
    getFirstOrderItem: function(conn, cb) {
        var me = this;

        cps.seq([
            function(_, cb) {
                me.<span class="apidocCodeKeywordSpan">linkedBy</span>(conn, 'items', cb);
            },
            function(items, cb) {
                cb(null, items[0]);
            }
        ], cb);
    }
},
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-mysql.Table.prototype.linksTo" id="apidoc.element.node-mysql.Table.prototype.linksTo">
        function <span class="apidocSignatureSpan">node-mysql.Table.prototype.</span>linksTo
        <span class="apidocSignatureSpan">(cfg)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">linksTo = function (cfg) {
    this._linksToMap[cfg.name] = {
        table: cfg.table,
        key: cfg.key
    };
    return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
}
})
.linkedBy({
    name: 'items',
    key: 'order_id',
    table: 'order_items'
})
.<span class="apidocCodeKeywordSpan">linksTo</span>({
    name: 'user',
    key: 'user_id',
    table: 'users'
})
.linksTo({
    name: 'coupon',
    key: 'coupon_id',
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-mysql.Table.prototype.lockById" id="apidoc.element.node-mysql.Table.prototype.lockById">
        function <span class="apidocSignatureSpan">node-mysql.Table.prototype.</span>lockById
        <span class="apidocSignatureSpan">(conn, id, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">lockById = function (conn, id, cb) {
    var me = this;

    cps.seq([
        function(_, cb) {
            me.find(conn, me.baseQuery('where ' + me.getIdFieldName() + ' = ? for update', [id]), cb);
        },
        function(res) {
            cb(null, res[0])
        }
    ], cb);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
], cb);
```

It finds a row in a table by its primary ID and returns a single row
object of the table's corresponding rowClass.

&lt;a name="table-lockById"/&gt;
### table.<span class="apidocCodeKeywordSpan">lockById</span>(database_connection, row_id, callback)

This function does the same thing as findById and additionally, it
locks the corresponding row for an atomic update.  lockById can ONLY
be used in a transaction context.  Without a transaction context, it
behaves the same as findById.  Once a row is locked in one
transaction, attempts of locking the same row in other transactions
will hang until the current transaction either commits or rolls back,
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-mysql.Table.prototype.relatesTo" id="apidoc.element.node-mysql.Table.prototype.relatesTo">
        function <span class="apidocSignatureSpan">node-mysql.Table.prototype.</span>relatesTo
        <span class="apidocSignatureSpan">(cfg)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">relatesTo = function (cfg) {
    this._relatesToMap[cfg.name] = {
        table: cfg.table,
        through: cfg.through,
        leftKey: cfg.leftKey,
        rightKey: cfg.rightKey
    };
    return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

Once a "linkedBy" is set up on a table, a row object corresponding to
this table can call the "linkedBy" method to pull more (associated)
data into the row.  See examples [here](#row-linkedBy).

&lt;a name="table-relatesTo"/&gt;

### table.<span class="apidocCodeKeywordSpan">relatesTo</span>(config)

The config object has the following schema:

```json
{
"name": {
    "type": "String",
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.node-mysql.db" id="apidoc.module.node-mysql.db">module node-mysql.db</a></h1>


    <h2>
        <a href="#apidoc.element.node-mysql.db.db" id="apidoc.element.node-mysql.db.db">
        function <span class="apidocSignatureSpan">node-mysql.</span>db
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">db = function () {
    this._init.apply(this, arguments);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-mysql.db.format" id="apidoc.element.node-mysql.db.format">
        function <span class="apidocSignatureSpan">node-mysql.db.</span>format
        <span class="apidocSignatureSpan">(str, bindings)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">format = function (str, bindings) {
    var l = str.split('?')

    if (l.length - 1 != bindings.length) {
        throw new Error('sql string format error');
    }

    var res = [];

    for (var i = 0; i &lt; bindings.length; i++) {
        res.push(l[i]);
        res.push(mysql.escape(bindings[i]));
    }

    res.push(l[l.length - 1]);

    return res.join(' ');
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
        }
    ], cb);
}, cb);
```


&lt;a name="DB-format" /&gt;
### DB.<span class="apidocCodeKeywordSpan">format</span>(query_string, variable_bindings)

This is a wrapper of the query string formatting functionality
provided by the mysql package.  Note that this is a global static
method defined on the class DB.  It is NOT an instance method defined
a a DB instance db.

__Example__
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.node-mysql.db.prototype" id="apidoc.module.node-mysql.db.prototype">module node-mysql.db.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.node-mysql.db.prototype._buildCfg" id="apidoc.element.node-mysql.db.prototype._buildCfg">
        function <span class="apidocSignatureSpan">node-mysql.db.prototype.</span>_buildCfg
        <span class="apidocSignatureSpan">(cfg, override)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_buildCfg = function (cfg, override) {
    var res = {};

    for (var k in cfg) {
        res[k] = cfg[k];
    }

    $U.extend(res, override);
    return res;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
delete cfg['useCursor'];

this._cfg = cfg;
// console.log(this._cfg);
this._pool = mysql.createPool(this._cfg);

if (transactionOverride) {
    this._transactionCfg = this.<span class="apidocCodeKeywordSpan">_buildCfg</span>(cfg, transactionOverride);
    // console.log('transactionCfg:', this._transactionCfg);
    this._transactionPool = mysql.createPool(this._transactionCfg);
}

if (cursorOverride) {
    this._cursorCfg = this._buildCfg(cfg, cursorOverride);
    // console.log('cursorCfg:', this._cursorCfg);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-mysql.db.prototype._connect" id="apidoc.element.node-mysql.db.prototype._connect">
        function <span class="apidocSignatureSpan">node-mysql.db.prototype.</span>_connect
        <span class="apidocSignatureSpan">(pool, proc, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_connect = function (pool, proc, cb) {
    var me = this;
    var conn;
    cps.seq([
        function(_, cb) {
            pool.getConnection(cb);
        },
        function(res, cb) {
            conn = res;
            cps.rescue({
                'try': function(cb) {
                    proc(conn, cb);
                },
                'finally': function(cb) {
                    // console.log('release connection');
                    conn.release();
                    cb();
                }
            }, cb);
        }
    ], cb);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    var me = this;

    cps.seq([
        function(_, cb) {
            me._prepare(cb);
        },
        function(_, cb) {
            me.<span class="apidocCodeKeywordSpan">_connect</span>(me._pool, proc, cb);
        }
    ], cb);
},

_prepare: function(cb) {
    if (this._prepared) {
        return cb();
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-mysql.db.prototype._enterTransaction" id="apidoc.element.node-mysql.db.prototype._enterTransaction">
        function <span class="apidocSignatureSpan">node-mysql.db.prototype.</span>_enterTransaction
        <span class="apidocSignatureSpan">(conn)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_enterTransaction = function (conn) {
    conn.__transaction__ = true;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
/*
function(_, cb) {
    me._getTxnConnection(cb);
},
*/
function(_, cb) {
    me._connect(me._transactionPool, function(conn, cb) {
        me.<span class="apidocCodeKeywordSpan">_enterTransaction</span>(conn);
        txnConn = conn;
        cps.rescue({
            'try': function(cb) {
                cps.seq([
                    function(_, cb) {
                        // console.log('start transaction');
                        txnConn.query('START TRANSACTION', cb);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-mysql.db.prototype._init" id="apidoc.element.node-mysql.db.prototype._init">
        function <span class="apidocSignatureSpan">node-mysql.db.prototype.</span>_init
        <span class="apidocSignatureSpan">(cfg)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_init = function (cfg) {
    var transactionOverride = cfg['useTransaction'];
    delete cfg['useTransaction'];

    var cursorOverride = cfg['useCursor'];
    delete cfg['useCursor'];

    this._cfg = cfg;
    // console.log(this._cfg);
    this._pool = mysql.createPool(this._cfg);

    if (transactionOverride) {
        this._transactionCfg = this._buildCfg(cfg, transactionOverride);
        // console.log('transactionCfg:', this._transactionCfg);
        this._transactionPool = mysql.createPool(this._transactionCfg);
    }

    if (cursorOverride) {
        this._cursorCfg = this._buildCfg(cfg, cursorOverride);
        // console.log('cursorCfg:', this._cursorCfg);
        this._cursorPool = mysql.createPool(this._cursorCfg);
    }

    this._schema = {};
    this._prepared = false;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-mysql.db.prototype._isTxnConnection" id="apidoc.element.node-mysql.db.prototype._isTxnConnection">
        function <span class="apidocSignatureSpan">node-mysql.db.prototype.</span>_isTxnConnection
        <span class="apidocSignatureSpan">(conn)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_isTxnConnection = function (conn) {
    return conn != null &amp;&amp; conn.__transaction__;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    cb(new Error('transaction-not-setup-error'));
    return;
}

var txnConn;
var commitRes;

if (me.<span class="apidocCodeKeywordSpan">_isTxnConnection</span>(conn)) {
    proc(conn, cb);
} else {
    cps.seq([
        function(_, cb) {
            me._prepare(cb);
        },
        /*
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-mysql.db.prototype._leaveTransaction" id="apidoc.element.node-mysql.db.prototype._leaveTransaction">
        function <span class="apidocSignatureSpan">node-mysql.db.prototype.</span>_leaveTransaction
        <span class="apidocSignatureSpan">(conn)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_leaveTransaction = function (conn) {
    conn.__transaction__ = false;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
                                }, cb);
                            }
                        ], cb);
                    },
                    'finally': function(cb) {
                        // console.log('txn connection release');
                        // txnConn.release();
                        me.<span class="apidocCodeKeywordSpan">_leaveTransaction</span>(txnConn);
                        cb();
                    }
                }, cb);
            }, cb);
        }
    ], cb);
}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-mysql.db.prototype._prepare" id="apidoc.element.node-mysql.db.prototype._prepare">
        function <span class="apidocSignatureSpan">node-mysql.db.prototype.</span>_prepare
        <span class="apidocSignatureSpan">(cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_prepare = function (cb) {
    if (this._prepared) {
        return cb();
    }

    // console.log('call prepare');
    var me = this;
    var conn;

    this._connect(me._pool, function(conn, cb) {
        cps.seq([
            function(res, cb) {
                conn.query('show tables', cb);
            },
            function(tables, cb) {
                cps.peach(tables, function(table, cb) {
                    var tableName = getValue(table);
                    cps.seq([
                        function(_, cb) {
                            conn.query('desc ' + tableName, cb);
                        },
                        function(columns, cb) {
                            me._schema[tableName] = $U.map(columns, function(column) {
                                return column['Field'];
                            });
                            me._prepared = true;
                            cb();
                        }
                    ], cb);
                }, cb);
            }
        ], cb);
    }, cb);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
},

connect: function(proc, cb) {
    var me = this;

    cps.seq([
        function(_, cb) {
            me.<span class="apidocCodeKeywordSpan">_prepare</span>(cb);
        },
        function(_, cb) {
            me._connect(me._pool, proc, cb);
        }
    ], cb);
},
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-mysql.db.prototype.connect" id="apidoc.element.node-mysql.db.prototype.connect">
        function <span class="apidocSignatureSpan">node-mysql.db.prototype.</span>connect
        <span class="apidocSignatureSpan">(proc, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">connect = function (proc, cb) {
    var me = this;

    cps.seq([
        function(_, cb) {
            me._prepare(cb);
        },
        function(_, cb) {
            me._connect(me._pool, proc, cb);
        }
    ], cb);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    database : 'prod_clone',
    connectionLimit: 1
}
```


&lt;a name="db-connect"&gt;
### db.<span class="apidocCodeKeywordSpan">connect</span>(procedure, callback)

The procedure is a function of the type:

```javascript
function(connection, callback) {
    // work with the database connection
}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-mysql.db.prototype.cursor" id="apidoc.element.node-mysql.db.prototype.cursor">
        function <span class="apidocSignatureSpan">node-mysql.db.prototype.</span>cursor
        <span class="apidocSignatureSpan">(q, proc, _cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">cursor = function (q, proc, _cb) {
    var me = this;

    if (!me._cursorPool) {
        _cb(new Error('cursor-not-setup-error'));
        return;
    }

    var returned = false;

    var cb = function(err, res) {
        if (!returned) {
            returned = true;
            _cb(err, res);
        } else {
        }
    }

    var breakCB =  cb;
    this._cursorPool.getConnection(function(err, conn) {
        var query = conn.query(q);
        query
            .on('error', function(err) {
                // console.log('cursor error');
                conn.release();
                cb(new Error(err));
            })
            .on('result', function(res) {
                // console.log('cursor result');
                conn.pause();

                var cb = function(err, res) {
                    if (err) {
                        conn.release();
                        breakCB(err);
                    } else {
                        conn.resume();
                    }
                };

                cps.seq([
                    function(_, cb) {
                        // console.log('call row processor');
                        proc(res, cb);
                    }
                ], cb);
            })
            .on('end', function() {
                // console.log('cursor end');
                conn.release();
                cb();
            })
        ;
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
          ], cb);
      // }, cb);
  }, cb);
};
```

&lt;a name="db-cursor"/&gt;
### db.<span class="apidocCodeKeywordSpan">cursor</span>(query_string, procedure, callback)

This API can be used to cursor thought the (potentially very long list
of) results of a query.  The procedure parameter is the operation to
be applied to each row in the results of the query.  Please note the following:

* db.cursor will create a separate db connection for cursoring
purpose.  That is why this API does not take a db_connection in the
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-mysql.db.prototype.end" id="apidoc.element.node-mysql.db.prototype.end">
        function <span class="apidocSignatureSpan">node-mysql.db.prototype.</span>end
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">end = function () {
    this._pool.end();
    if (this._transactionPool) {
        this._transactionPool.end();
    }
    if (this._cursorPool) {
        this._cursorPool.end();
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
};
```




&lt;a name="db-end" /&gt;
### db.<span class="apidocCodeKeywordSpan">end</span>();

This function destructs the db object.

&lt;a name="db-add"/&gt;

### db.add(config);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-mysql.db.prototype.getConnection" id="apidoc.element.node-mysql.db.prototype.getConnection">
        function <span class="apidocSignatureSpan">node-mysql.db.prototype.</span>getConnection
        <span class="apidocSignatureSpan">(cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">getConnection = function (cb) {
    var me = this;

    cps.seq([
        function(_, cb) {
            me._prepare(cb);
        },
        function(_, cb) {
            me._pool.getConnection(cb);
        }
    ], cb);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
},

_connect: function(pool, proc, cb) {
    var me = this;
    var conn;
    cps.seq([
        function(_, cb) {
            pool.<span class="apidocCodeKeywordSpan">getConnection</span>(cb);
        },
        function(res, cb) {
            conn = res;
            cps.rescue({
                'try': function(cb) {
                    proc(conn, cb);
                },
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-mysql.db.prototype.transaction" id="apidoc.element.node-mysql.db.prototype.transaction">
        function <span class="apidocSignatureSpan">node-mysql.db.prototype.</span>transaction
        <span class="apidocSignatureSpan">(conn, proc, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">transaction = function (conn, proc, cb) {
    var me = this;

    if (!me._transactionPool) {
        cb(new Error('transaction-not-setup-error'));
        return;
    }

    var txnConn;
    var commitRes;

    if (me._isTxnConnection(conn)) {
        proc(conn, cb);
    } else {
        cps.seq([
            function(_, cb) {
                me._prepare(cb);
            },
<span class="apidocCodeCommentSpan">            /*
            function(_, cb) {
                me._getTxnConnection(cb);
            },
            */
</span>            function(_, cb) {
                me._connect(me._transactionPool, function(conn, cb) {
                    me._enterTransaction(conn);
                    txnConn = conn;
                    cps.rescue({
                        'try': function(cb) {
                            cps.seq([
                                function(_, cb) {
                                    // console.log('start transaction');
                                    txnConn.query('START TRANSACTION', cb);
                                },
                                function(_, cb) {
                                    cps.rescue({
                                        'try': function(cb) {
                                            cps.seq([
                                                function(_, cb) {
                                                    proc(txnConn, cb);
                                                },
                                                function(res, cb) {
                                                    commitRes = res;
                                                    // console.log('committing');
                                                    txnConn.query('COMMIT', cb);
                                                },
                                                function(_, cb) {
                                                    // console.log('committed');
                                                    cb(null, commitRes);
                                                }
                                            ], cb);
                                        },
                                        'catch': function(err, cb) {
                                            cps.seq([
                                                function(_, cb) {
                                                    // console.log('rolling back ...');
                                                    txnConn.query('ROLLBACK', cb);
                                                },
                                                function(_, cb) {
                                                    // console.log('rolled back');
                                                    throw(err);
                                                }
                                            ], cb);
                                        }
                                    }, cb);
                                }
                            ], cb);
                        },
                        'finally': function(cb) {
                            // console.log('txn connection release');
                            // txnConn.release();
                            me._leaveTransaction(txnConn);
                            cb();
                        }
                    }, cb);
                }, cb);
            }
        ], cb);
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
            }
        ], cb);
    }, cb);
};
```

&lt;a name="db-transaction"/&gt;
### db.<span class="apidocCodeKeywordSpan">transaction</span>(db_connection, procedure, callback)

The procedure is a function of the type:

```javascript
function(connection, callback) {
    // work with the database connection
}
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.node-mysql.model" id="apidoc.module.node-mysql.model">module node-mysql.model</a></h1>


    <h2>
        <a href="#apidoc.element.node-mysql.model.Row" id="apidoc.element.node-mysql.model.Row">
        function <span class="apidocSignatureSpan">node-mysql.model.</span>Row
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">Row = function () {
    this._init.apply(this, arguments);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
var q = 'select * from users';

db.cursor(q, function(row, cb) {
    cps.rescur({
        'try': function() {
            cps.seq([
                function(_, cb) {
                    var user = new User.<span class="apidocCodeKeywordSpan">Row</span>(row);
                    user.update(conn, {active: 1}, cb);
                },
                function(res, cb) {
                    console.log(res);
                    cb();
                }
            ], cb);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-mysql.model.Table" id="apidoc.element.node-mysql.model.Table">
        function <span class="apidocSignatureSpan">node-mysql.model.</span>Table
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">Table = function () {
    this._init.apply(this, arguments);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>




</div>

<div class="apidocFooterDiv">
    [ this document was created with
    <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a>
    ]
</div>
</div>
</body></html>